{"ast":null,"code":"import _objectSpread from\"D:/SRC/XAMPP/htdocs/sites/Briefer-v02/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useRef,lazy,Suspense}from'react';import{useLocation,useNavigate}from'react-router-dom';import{DragDropContext,Droppable,Draggable}from'@hello-pangea/dnd';import Card from'./Card';import ArticleGenerator from'./ArticleGenerator';import CardEditor from'./CardEditor';import ActionButtons from'./ActionButtons';import RefinementBar from'./RefinementBar';import FilterModal from'./FilterModal';import RegistrationModal from'./RegistrationModal';import ThreeColumnLayout from'./ThreeColumnLayout';import LeftNavigation from'./LeftNavigation';import RightSidebar from'./RightSidebar';import{ArticleManager}from'../utils/ArticleManager';import{useAuth}from'../context/AuthContext';import{ARTICLE_FILTERS,buildDetailedPrompt}from'../data/filterOptions';import Header from'./Header';import Footer from'./Footer';import ProfilePage from'./ProfilePage';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function ArticleEditorApp(){const{user,loading,logout}=useAuth();const location=useLocation();const navigate=useNavigate();const[cards,setCards]=useState([]);const[articleTitle,setArticleTitle]=useState('');const[view,setView]=useState('loading');// 'loading', 'generator', 'editor'\nconst[showNotification,setShowNotification]=useState({show:false,message:'',type:'info'});const[isGenerating,setIsGenerating]=useState(false);const[currentArticleId,setCurrentArticleId]=useState(null);const[loadedFromNavigation,setLoadedFromNavigation]=useState(false);// Track if loaded from navigation\nconst cardEditorRef=useRef();const[isEditorLoaded,setIsEditorLoaded]=useState(false);const[refinementPrompt,setRefinementPrompt]=useState('');const[showFilterModal,setShowFilterModal]=useState(false);const[filters,setFilters]=useState([]);const[selectedFilters,setSelectedFilters]=useState({});const[isEditingTitle,setIsEditingTitle]=useState(false);const titleInputRef=useRef(null);const[showRegistrationModal,setShowRegistrationModal]=useState(false);// Helper for notifications\nconst showNotificationMessage=function(message){let type=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'info';setShowNotification({show:true,message,type});setTimeout(()=>{setShowNotification({show:false,message:'',type:'info'});},4000);};// Core generation logic\nconst handleGenerate=async function(topic,detailedPrompt){let targetId=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;setIsGenerating(true);// Determine ID: use targetId if provided, otherwise create new\nlet activeId=targetId;if(!activeId){activeId=ArticleManager.createArticle(topic);setCurrentArticleId(activeId);// Update URL to reflect the new ID\nwindow.history.pushState(null,'',\"?id=\".concat(activeId));}try{const response=await fetch('http://localhost:3003/api/ai/generate-article',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({topic:topic,detailedPrompt:detailedPrompt})});if(!response.ok){const errorData=await response.json();const errorMessage=errorData.details||errorData.error||\"API request failed: \".concat(response.status);throw new Error(errorMessage);}const data=await response.json();const aiResponse=data.content;// --- Validation Check (Backend handles this now, or we skip it) ---\nif(aiResponse.startsWith('ERROR:')){showNotificationMessage(aiResponse,'error');setIsGenerating(false);return;}// --- HTML Parsing Logic ---\nlet title=topic;// Fallback\nlet bodyContent=aiResponse;// 1. Extract Title (<h1>)\nconst h1Match=aiResponse.match(/<h1[^>]*>(.*?)<\\/h1>/i);if(h1Match){title=h1Match[1].trim();// Remove the H1 from the content to process the rest\nbodyContent=aiResponse.replace(h1Match[0],'').trim();}setArticleTitle(title);// 2. Split into Sections by <h2>\n// The regex splits by h2, capturing the inner text of the h2\n// Result will be: [intro_content, h2_text_1, section_content_1, h2_text_2, section_content_2, ...]\nconst parts=bodyContent.split(/<h2[^>]*>(.*?)<\\/h2>/i);const newCards=[];// Handle Introduction (content before first h2)\nif(parts[0]&&parts[0].trim()){const sectionId=\"section-intro-\".concat(Date.now());let htmlContent=parts[0].trim();// Add title for consistency if missing, or just treat as intro\nif(!htmlContent.includes('<h2')){htmlContent=\"<h2 class=\\\"text-2xl font-semibold mb-4 text-gray-800\\\">Introduction</h2>\"+htmlContent;}// htmlContent += `<div class=\"flex justify-end\"><a href=\"#\" class=\"edit-link\" data-card-id=\"${sectionId}\">EDIT</a></div>`;\nnewCards.push({id:sectionId,content:htmlContent});}// Loop through the rest of the parts in pairs (Title, Content)\nfor(let i=1;i<parts.length;i+=2){const sectionTitle=parts[i].trim();let sectionContent=parts[i+1]?parts[i+1].trim():'';if(!sectionContent&&!sectionTitle)continue;const sectionId=\"section-\".concat(i,\"-\").concat(Date.now());// Construct the card HTML\nlet htmlContent=\"<h2 class=\\\"text-2xl font-semibold mb-4 text-gray-800\\\">\".concat(sectionTitle,\"</h2>\")+sectionContent;// htmlContent += `<div class=\"flex justify-end\"><a href=\"#\" class=\"edit-link\" data-card-id=\"${sectionId}\">EDIT</a></div>`;\nnewCards.push({id:sectionId,content:htmlContent});}setCards(newCards);// Save to ArticleManager\nArticleManager.saveArticle(activeId,{title:title,cards:newCards});setView('editor');showNotificationMessage('Article generated successfully!','success');}catch(error){console.error('Generation Error:',error);showNotificationMessage(\"Generation failed: \".concat(error.message),'error');}finally{setIsGenerating(false);}};// Generate dynamic filters based on article topic\nconst generateFilters=()=>{return ARTICLE_FILTERS;};// Handle incoming article data from navigation (e.g., from CategoryArticlesPage)\nuseEffect(()=>{var _location$state,_location$state2;console.log('ðŸ” ArticleEditorApp - location.state:',location.state);if((_location$state=location.state)!==null&&_location$state!==void 0&&_location$state.editArticle){const{id,title,cards:articleCards}=location.state.editArticle;console.log('âœ… Loading article:',{id,title,cardsCount:articleCards===null||articleCards===void 0?void 0:articleCards.length});// Normalize cards to ensure they all have ids\nconst rawCards=Array.isArray(articleCards)?articleCards:[];const normalizedCards=rawCards.map((card,index)=>_objectSpread({id:card.id||\"card-\".concat(index,\"-\").concat(Date.now())},card));// Save to ArticleManager for persistence\nArticleManager.saveArticle(id.toString(),{title:title,cards:normalizedCards});setCurrentArticleId(id);setArticleTitle(title||'Untitled Article');setCards(normalizedCards);setView('editor');setLoadedFromNavigation(true);// Mark as loaded from navigation\n// Update URL with article ID and clear navigation state\nwindow.history.replaceState({},document.title,\"?id=\".concat(id));}else if((_location$state2=location.state)!==null&&_location$state2!==void 0&&_location$state2.generateRequest){const{topic,detailedPrompt}=location.state.generateRequest;console.log('âœ¨ Handling generation request from navigation:',{topic});// Clear the state so it doesn't re-trigger on reload\nwindow.history.replaceState({},document.title,window.location.pathname);handleGenerate(topic,detailedPrompt);}else{console.log('âš ï¸ No editArticle or generateRequest in location.state');}},[location.state]);// Handle filter changes\nconst handleFilterChange=function(filterId,value){let isMulti=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;setSelectedFilters(prev=>{if(isMulti){const currentValues=prev[filterId]||[];const newValues=currentValues.includes(value)?currentValues.filter(v=>v!==value):[...currentValues,value];return _objectSpread(_objectSpread({},prev),{},{[filterId]:newValues});}return _objectSpread(_objectSpread({},prev),{},{[filterId]:value});});};// Clean all filters\nconst handleCleanFilters=()=>{setSelectedFilters({});};// Regenerate with filters\nconst handleRegenerateWithFilters=()=>{setShowFilterModal(false);// Build detailed prompt from filters\nlet detailedPrompt=buildDetailedPrompt(selectedFilters);const fullPrompt=refinementPrompt.trim()?\"How to \".concat(refinementPrompt,\" \"):articleTitle;handleGenerate(fullPrompt,detailedPrompt,currentArticleId);setRefinementPrompt('');};// Load filters when modal opens\nuseEffect(()=>{if(showFilterModal&&filters.length===0){setFilters(generateFilters());}},[showFilterModal]);// Fetch article from backend if not in localStorage\nconst fetchArticleFromBackend=async articleId=>{try{const response=await fetch(\"http://localhost:3003/api/articles/\".concat(articleId),{credentials:'include'});if(!response.ok){throw new Error('Article not found');}const{article}=await response.json();// Parse content if it's a string\nlet parsedCards=[];try{parsedCards=typeof article.content==='string'?JSON.parse(article.content):article.content;}catch(e){console.error('Failed to parse article content',e);parsedCards=[];}// Save to ArticleManager for future access\nArticleManager.saveArticle(articleId.toString(),{title:article.title,cards:parsedCards});setCurrentArticleId(articleId);setArticleTitle(article.title||'Untitled Article');setCards(parsedCards||[]);setView('editor');}catch(error){console.error('Error fetching article from backend:',error);showNotificationMessage('Article not found. Redirecting to generator.','error');window.history.replaceState(null,'','/create');setView('generator');}};// Initialization & Routing\nuseEffect(()=>{// Skip if article is already loaded from navigation state\nif(loadedFromNavigation){console.log('â© Skipping initialization - article already loaded from navigation state');return;}console.log('ðŸ” Initialization useEffect - checking URL params');const params=new URLSearchParams(window.location.search);const urlId=params.get('id');const urlTopic=params.get('topic');const urlTemplate=params.get('template');if(urlId){// Case 1: Load existing article by ID\nconsole.log('ðŸ“‚ Loading article by ID:',urlId);const article=ArticleManager.getArticle(urlId);console.log('ðŸ“¦ Article from ArticleManager:',article);if(article){var _article$cards;console.log('âœ… Setting cards from ArticleManager:',((_article$cards=article.cards)===null||_article$cards===void 0?void 0:_article$cards.length)||0,'cards');setCurrentArticleId(urlId);setArticleTitle(article.title);setCards(article.cards||[]);setView('editor');}else{// Article not in localStorage, try to fetch from backend\nconsole.log('ðŸ” Article not in localStorage, fetching from backend...');fetchArticleFromBackend(urlId);}}else if(urlTopic){// Case 2: AI Link Trigger (New Article from Topic)\n// Create the article immediately\nconst newId=ArticleManager.createArticle(urlTopic,urlTemplate||'guide');setCurrentArticleId(newId);setArticleTitle(urlTopic);// Update URL so we don't regenerate on reload\nwindow.history.replaceState(null,'',\"?id=\".concat(newId));// Trigger generation\nhandleGenerate(urlTopic,null,newId);}else{// Case 3: No ID, No Topic. Check for legacy data migration or show generator.\nconst migratedId=ArticleManager.migrateOldData();if(migratedId){const article=ArticleManager.getArticle(migratedId);setCurrentArticleId(migratedId);setArticleTitle(article.title);setCards(article.cards||[]);setView('editor');window.history.replaceState(null,'',\"?id=\".concat(migratedId));showNotificationMessage('Restored your previous session.','info');}else{console.log('ðŸŽ¸ No article to load - showing generator');setView('generator');}}},[loadedFromNavigation]);// Handle edit link clicks\nconst handleEditCard=card=>{const event=new CustomEvent('openEditModal',{detail:card});window.dispatchEvent(event);};const saveAllData=async()=>{// Wait for auth state to load\nif(loading){showNotificationMessage('Please wait...','info');return;}// Check if user is authenticated\nif(!user){setShowRegistrationModal(true);return;}// Save to backend\ntry{console.log('ðŸ’¾ Starting save process...');console.log('ðŸ’¾ Current article ID:',currentArticleId);console.log('ðŸ’¾ Title:',articleTitle);console.log('ðŸ’¾ Cards count:',cards===null||cards===void 0?void 0:cards.length);// Always create a new draft for category articles (they're copies)\n// For user's own articles, we could add update logic later\nconst createResponse=await fetch('http://localhost:3003/api/articles',{method:'POST',headers:{'Content-Type':'application/json'},credentials:'include',body:JSON.stringify({title:articleTitle,content:cards})});if(!createResponse.ok){throw new Error('Failed to create article on backend');}const{article}=await createResponse.json();const backendArticleId=article.id;console.log('âœ… Article created with ID:',backendArticleId);// Attach it to the authenticated user\nconst attachResponse=await fetch(\"http://localhost:3003/api/articles/\".concat(backendArticleId,\"/attach\"),{method:'PUT',headers:{'Content-Type':'application/json'},credentials:'include'});if(!attachResponse.ok){throw new Error('Failed to attach article to user');}console.log('âœ… Article attached to user');// Update local state with the new backend ID\nsetCurrentArticleId(backendArticleId);console.log('âœ… Updated currentArticleId to:',backendArticleId);// Save to ArticleManager with the backend ID\nArticleManager.saveArticle(backendArticleId.toString(),{title:articleTitle,cards:cards});// Update URL to reflect the new backend ID\nwindow.history.replaceState(null,'',\"?id=\".concat(backendArticleId));console.log('âœ… URL updated to:',\"?id=\".concat(backendArticleId));showNotificationMessage('Article saved to your profile!','success');console.log('âœ… Save complete!');}catch(error){console.error('âŒ Save error:',error);showNotificationMessage('Failed to save article','error');}};const reloadPage=()=>{if(loadedFromNavigation){navigate(-1);return;}if(window.confirm('Are you sure you want to start over? You will return to the generator.')){window.location.href='/create';}};const addNewCard=()=>{const newCard={id:'card-'+Date.now(),content:'',isNew:true// Explicitly mark as new\n};const event=new CustomEvent('openEditModal',{detail:newCard});window.dispatchEvent(event);};// Callback function to open the edit modal\nconst handleOpenEditModal=card=>{if(cardEditorRef.current&&cardEditorRef.current.openEditModal){cardEditorRef.current.openEditModal(card);}};// Title Editing Handlers\nconst handleTitleClick=()=>{setIsEditingTitle(true);setTimeout(()=>{if(titleInputRef.current){titleInputRef.current.focus();}},100);};const handleTitleChange=e=>{setArticleTitle(e.target.value);};const handleTitleBlur=()=>{setIsEditingTitle(false);saveAllData();// Auto-save on blur\n};const handleTitleKeyDown=e=>{if(e.key==='Enter'){e.preventDefault();titleInputRef.current.blur();// This will trigger handleTitleBlur and save\n}};const handleMoveUp=index=>{if(index===0)return;const newCards=[...cards];const[item]=newCards.splice(index,1);newCards.splice(index-1,0,item);setCards(newCards);// We should probably save here too, but dragging expects manual save usually. \n// For buttons, user might expect auto-update or manual save. \n// Let's rely on the explicit Save button for now to avoid too many writes, \n// or we could add a debounced save.\n};const handleMoveDown=index=>{if(index===cards.length-1)return;const newCards=[...cards];const[item]=newCards.splice(index,1);newCards.splice(index+1,0,item);setCards(newCards);};const handleDeleteCard=cardId=>{// Temporary removal of confirm for debugging\n// if (window.confirm('Are you sure you want to delete this card?')) {\nconsole.log(\"[DELETE] Request for ID: \\\"\".concat(cardId,\"\\\" (Type: \").concat(typeof cardId,\")\"));setCards(prevCards=>{console.log(\"[DELETE] Current card count: \".concat(prevCards.length));// Check if ID exists before filtering\nconst exists=prevCards.some(c=>c.id===cardId);if(!exists){console.warn(\"[DELETE] Warning: Card ID \\\"\".concat(cardId,\"\\\" not found in current state!\"));console.log('[DELETE] Available IDs:',prevCards.map(c=>c.id));}const newCards=prevCards.filter(card=>{const isMatch=card.id===cardId;if(isMatch){console.log(\"[DELETE] Matching card found and removed: \\\"\".concat(card.id,\"\\\"\"));}return!isMatch;});console.log(\"[DELETE] New card count: \".concat(newCards.length));return newCards;});// }\n};const handleDragEnd=result=>{if(!result.destination)return;const items=Array.from(cards);const[reorderedItem]=items.splice(result.source.index,1);items.splice(result.destination.index,0,reorderedItem);setCards(items);};const handleNavigate=newView=>{setView(newView);if(newView==='generator'){window.history.pushState(null,'','/create');}else if(newView==='profile'){window.history.pushState(null,'','/profile');}};const handleEditArticle=article=>{setCurrentArticleId(article.id);setArticleTitle(article.title);let parsedCards=[];try{parsedCards=typeof article.content==='string'?JSON.parse(article.content):article.content;}catch(e){console.error(\"Failed to parse article content\",e);parsedCards=[];}setCards(parsedCards||[]);setView('editor');window.history.pushState(null,'',\"?id=\".concat(article.id));};// Preload the editor when the app loads\nuseEffect(()=>{const timer=setTimeout(()=>{setIsEditorLoaded(true);},100);return()=>clearTimeout(timer);},[]);const renderContent=()=>{if(view==='loading'){return/*#__PURE__*/_jsx(ThreeColumnLayout,{children:/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-center items-center min-h-[50vh]\",children:\"Loading...\"})});}if(view==='generator'){return/*#__PURE__*/_jsx(ThreeColumnLayout,{left:/*#__PURE__*/_jsx(LeftNavigation,{}),right:/*#__PURE__*/_jsx(RightSidebar,{}),children:/*#__PURE__*/_jsx(ArticleGenerator,{onGenerate:handleGenerate,isGenerating:isGenerating,showInfo:false})});}// Editor View\nreturn/*#__PURE__*/_jsxs(ThreeColumnLayout,{left:/*#__PURE__*/_jsx(LeftNavigation,{}),right:/*#__PURE__*/_jsx(RightSidebar,{}),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-6 sm:p-8 rounded-lg shadow-lg\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-end mb-2\",children:/*#__PURE__*/_jsx(\"button\",{onClick:reloadPage,className:\"text-gray-400 hover:text-gray-600 focus:outline-none\",title:\"Start Over\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"w-6 h-6\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",xmlns:\"http://www.w3.org/2000/svg\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:\"2\",d:\"M6 18L18 6M6 6l12 12\"})})})}),isEditingTitle?/*#__PURE__*/_jsx(\"input\",{ref:titleInputRef,type:\"text\",className:\"text-4xl font-bold mb-8 text-gray-900 w-full border-b-2 border-blue-500 focus:outline-none\",value:articleTitle,onChange:handleTitleChange,onBlur:handleTitleBlur,onKeyDown:handleTitleKeyDown}):/*#__PURE__*/_jsx(\"h1\",{className:\"text-4xl font-bold mb-8 text-gray-900 cursor-pointer hover:bg-gray-50 rounded px-2 -ml-2 transition-colors duration-200\",onClick:handleTitleClick,title:\"Click to edit title\",children:articleTitle}),/*#__PURE__*/_jsx(DragDropContext,{onDragEnd:handleDragEnd,children:/*#__PURE__*/_jsx(Droppable,{droppableId:\"article-cards\",children:provided=>/*#__PURE__*/_jsxs(\"div\",_objectSpread(_objectSpread({},provided.droppableProps),{},{ref:provided.innerRef,children:[cards.map((card,index)=>/*#__PURE__*/_jsx(Draggable,{draggableId:card.id,index:index,children:(provided,snapshot)=>/*#__PURE__*/_jsx(\"div\",_objectSpread(_objectSpread({ref:provided.innerRef},provided.draggableProps),{},{className:\"flex flex-row items-stretch gap-2 mb-4 group transition-colors \".concat(snapshot.isDragging?'opacity-70':''),children:/*#__PURE__*/_jsx(\"div\",{className:\"flex-1 min-w-0\",children:/*#__PURE__*/_jsx(Card,{card:card,onEdit:handleEditCard,onMoveUp:()=>handleMoveUp(index),onMoveDown:()=>handleMoveDown(index),onDelete:()=>handleDeleteCard(card.id),isFirst:index===0,isLast:index===cards.length-1})})}))},card.id)),provided.placeholder]}))})}),/*#__PURE__*/_jsx(ActionButtons,{onSave:saveAllData,onAddCard:addNewCard})]}),/*#__PURE__*/_jsx(RefinementBar,{value:refinementPrompt,onChange:setRefinementPrompt,onFilterClick:()=>setShowFilterModal(true),onSend:()=>{if(refinementPrompt.trim()||Object.keys(selectedFilters).length>0){handleRegenerateWithFilters();}},isGenerating:isGenerating,hasFilters:Object.keys(selectedFilters).length>0})]});};const handleLoginClick=()=>{setShowRegistrationModal(true);};return/*#__PURE__*/_jsxs(\"div\",{className:\"min-h-screen bg-white flex flex-col\",children:[/*#__PURE__*/_jsx(Header,{articleId:currentArticleId,articleTitle:articleTitle,isEditingTitle:isEditingTitle,setIsEditingTitle:setIsEditingTitle,titleInputRef:titleInputRef,user:user,loading:loading,logout:logout,view:view,setView:setView,showNotificationMessage:showNotificationMessage}),renderContent(),/*#__PURE__*/_jsx(Footer,{}),/*#__PURE__*/_jsx(FilterModal,{isOpen:showFilterModal,onClose:()=>setShowFilterModal(false),filters:filters,selectedFilters:selectedFilters,onFilterChange:handleFilterChange,onClean:handleCleanFilters,onRegenerate:handleRegenerateWithFilters,isLoading:false}),showNotification.show&&/*#__PURE__*/_jsx(\"div\",{className:\"notification notification-\".concat(showNotification.type),children:showNotification.message}),isEditorLoaded&&/*#__PURE__*/_jsx(Suspense,{fallback:/*#__PURE__*/_jsx(\"div\",{children:\"Loading editor...\"}),children:/*#__PURE__*/_jsx(CardEditor,{ref:cardEditorRef,cards:cards,setCards:setCards,showNotification:showNotificationMessage})}),/*#__PURE__*/_jsx(RegistrationModal,{isOpen:showRegistrationModal,onClose:()=>setShowRegistrationModal(false),onSuccess:async()=>{setShowRegistrationModal(false);// If we are in editor, save the article after successful authentication\nif(view==='editor'){await saveAllData();}}})]});}export default ArticleEditorApp;","map":{"version":3,"names":["React","useState","useEffect","useRef","lazy","Suspense","useLocation","useNavigate","DragDropContext","Droppable","Draggable","Card","ArticleGenerator","CardEditor","ActionButtons","RefinementBar","FilterModal","RegistrationModal","ThreeColumnLayout","LeftNavigation","RightSidebar","ArticleManager","useAuth","ARTICLE_FILTERS","buildDetailedPrompt","Header","Footer","ProfilePage","jsx","_jsx","jsxs","_jsxs","ArticleEditorApp","user","loading","logout","location","navigate","cards","setCards","articleTitle","setArticleTitle","view","setView","showNotification","setShowNotification","show","message","type","isGenerating","setIsGenerating","currentArticleId","setCurrentArticleId","loadedFromNavigation","setLoadedFromNavigation","cardEditorRef","isEditorLoaded","setIsEditorLoaded","refinementPrompt","setRefinementPrompt","showFilterModal","setShowFilterModal","filters","setFilters","selectedFilters","setSelectedFilters","isEditingTitle","setIsEditingTitle","titleInputRef","showRegistrationModal","setShowRegistrationModal","showNotificationMessage","arguments","length","undefined","setTimeout","handleGenerate","topic","detailedPrompt","targetId","activeId","createArticle","window","history","pushState","concat","response","fetch","method","headers","body","JSON","stringify","ok","errorData","json","errorMessage","details","error","status","Error","data","aiResponse","content","startsWith","title","bodyContent","h1Match","match","trim","replace","parts","split","newCards","sectionId","Date","now","htmlContent","includes","push","id","i","sectionTitle","sectionContent","saveArticle","console","generateFilters","_location$state","_location$state2","log","state","editArticle","articleCards","cardsCount","rawCards","Array","isArray","normalizedCards","map","card","index","_objectSpread","toString","replaceState","document","generateRequest","pathname","handleFilterChange","filterId","value","isMulti","prev","currentValues","newValues","filter","v","handleCleanFilters","handleRegenerateWithFilters","fullPrompt","fetchArticleFromBackend","articleId","credentials","article","parsedCards","parse","e","params","URLSearchParams","search","urlId","get","urlTopic","urlTemplate","getArticle","_article$cards","newId","migratedId","migrateOldData","handleEditCard","event","CustomEvent","detail","dispatchEvent","saveAllData","createResponse","backendArticleId","attachResponse","reloadPage","confirm","href","addNewCard","newCard","isNew","handleOpenEditModal","current","openEditModal","handleTitleClick","focus","handleTitleChange","target","handleTitleBlur","handleTitleKeyDown","key","preventDefault","blur","handleMoveUp","item","splice","handleMoveDown","handleDeleteCard","cardId","prevCards","exists","some","c","warn","isMatch","handleDragEnd","result","destination","items","from","reorderedItem","source","handleNavigate","newView","handleEditArticle","timer","clearTimeout","renderContent","children","className","left","right","onGenerate","showInfo","onClick","fill","stroke","viewBox","xmlns","strokeLinecap","strokeLinejoin","strokeWidth","d","ref","onChange","onBlur","onKeyDown","onDragEnd","droppableId","provided","droppableProps","innerRef","draggableId","snapshot","draggableProps","isDragging","onEdit","onMoveUp","onMoveDown","onDelete","isFirst","isLast","placeholder","onSave","onAddCard","onFilterClick","onSend","Object","keys","hasFilters","handleLoginClick","isOpen","onClose","onFilterChange","onClean","onRegenerate","isLoading","fallback","onSuccess"],"sources":["D:/SRC/XAMPP/htdocs/sites/Briefer-v02/src/components/ArticleEditorApp.js"],"sourcesContent":["import React, { useState, useEffect, useRef, lazy, Suspense } from 'react';\r\nimport { useLocation, useNavigate } from 'react-router-dom';\r\nimport { DragDropContext, Droppable, Draggable } from '@hello-pangea/dnd';\r\nimport Card from './Card';\r\nimport ArticleGenerator from './ArticleGenerator';\r\nimport CardEditor from './CardEditor';\r\nimport ActionButtons from './ActionButtons';\r\nimport RefinementBar from './RefinementBar';\r\nimport FilterModal from './FilterModal';\r\nimport RegistrationModal from './RegistrationModal';\r\nimport ThreeColumnLayout from './ThreeColumnLayout';\r\nimport LeftNavigation from './LeftNavigation';\r\nimport RightSidebar from './RightSidebar';\r\n\r\nimport { ArticleManager } from '../utils/ArticleManager';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { ARTICLE_FILTERS, buildDetailedPrompt } from '../data/filterOptions';\r\nimport Header from './Header';\r\nimport Footer from './Footer';\r\nimport ProfilePage from './ProfilePage';\r\n\r\nfunction ArticleEditorApp() {\r\n    const { user, loading, logout } = useAuth();\r\n    const location = useLocation();\r\n    const navigate = useNavigate();\r\n    const [cards, setCards] = useState([]);\r\n    const [articleTitle, setArticleTitle] = useState('');\r\n    const [view, setView] = useState('loading'); // 'loading', 'generator', 'editor'\r\n    const [showNotification, setShowNotification] = useState({ show: false, message: '', type: 'info' });\r\n    const [isGenerating, setIsGenerating] = useState(false);\r\n    const [currentArticleId, setCurrentArticleId] = useState(null);\r\n    const [loadedFromNavigation, setLoadedFromNavigation] = useState(false); // Track if loaded from navigation\r\n    const cardEditorRef = useRef();\r\n    const [isEditorLoaded, setIsEditorLoaded] = useState(false);\r\n    const [refinementPrompt, setRefinementPrompt] = useState('');\r\n    const [showFilterModal, setShowFilterModal] = useState(false);\r\n    const [filters, setFilters] = useState([]);\r\n    const [selectedFilters, setSelectedFilters] = useState({});\r\n    const [isEditingTitle, setIsEditingTitle] = useState(false);\r\n    const titleInputRef = useRef(null);\r\n    const [showRegistrationModal, setShowRegistrationModal] = useState(false);\r\n\r\n    // Helper for notifications\r\n    const showNotificationMessage = (message, type = 'info') => {\r\n        setShowNotification({ show: true, message, type });\r\n        setTimeout(() => {\r\n            setShowNotification({ show: false, message: '', type: 'info' });\r\n        }, 4000);\r\n    };\r\n\r\n    // Core generation logic\r\n    const handleGenerate = async (topic, detailedPrompt, targetId = null) => {\r\n        setIsGenerating(true);\r\n\r\n        // Determine ID: use targetId if provided, otherwise create new\r\n        let activeId = targetId;\r\n        if (!activeId) {\r\n            activeId = ArticleManager.createArticle(topic);\r\n            setCurrentArticleId(activeId);\r\n            // Update URL to reflect the new ID\r\n            window.history.pushState(null, '', `?id=${activeId}`);\r\n        }\r\n\r\n        try {\r\n            const response = await fetch('http://localhost:3003/api/ai/generate-article', {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json'\r\n                },\r\n                body: JSON.stringify({\r\n                    topic: topic,\r\n                    detailedPrompt: detailedPrompt\r\n                })\r\n            });\r\n\r\n            if (!response.ok) {\r\n                const errorData = await response.json();\r\n                const errorMessage = errorData.details || errorData.error || `API request failed: ${response.status}`;\r\n                throw new Error(errorMessage);\r\n            }\r\n\r\n            const data = await response.json();\r\n            const aiResponse = data.content;\r\n\r\n            // --- Validation Check (Backend handles this now, or we skip it) ---\r\n            if (aiResponse.startsWith('ERROR:')) {\r\n                showNotificationMessage(aiResponse, 'error');\r\n                setIsGenerating(false);\r\n                return;\r\n            }\r\n\r\n            // --- HTML Parsing Logic ---\r\n\r\n            let title = topic; // Fallback\r\n            let bodyContent = aiResponse;\r\n\r\n            // 1. Extract Title (<h1>)\r\n            const h1Match = aiResponse.match(/<h1[^>]*>(.*?)<\\/h1>/i);\r\n            if (h1Match) {\r\n                title = h1Match[1].trim();\r\n                // Remove the H1 from the content to process the rest\r\n                bodyContent = aiResponse.replace(h1Match[0], '').trim();\r\n            }\r\n\r\n            setArticleTitle(title);\r\n\r\n            // 2. Split into Sections by <h2>\r\n            // The regex splits by h2, capturing the inner text of the h2\r\n            // Result will be: [intro_content, h2_text_1, section_content_1, h2_text_2, section_content_2, ...]\r\n            const parts = bodyContent.split(/<h2[^>]*>(.*?)<\\/h2>/i);\r\n\r\n            const newCards = [];\r\n\r\n            // Handle Introduction (content before first h2)\r\n            if (parts[0] && parts[0].trim()) {\r\n                const sectionId = `section-intro-${Date.now()}`;\r\n                let htmlContent = parts[0].trim();\r\n\r\n                // Add title for consistency if missing, or just treat as intro\r\n                if (!htmlContent.includes('<h2')) {\r\n                    htmlContent = `<h2 class=\"text-2xl font-semibold mb-4 text-gray-800\">Introduction</h2>` + htmlContent;\r\n                }\r\n                // htmlContent += `<div class=\"flex justify-end\"><a href=\"#\" class=\"edit-link\" data-card-id=\"${sectionId}\">EDIT</a></div>`;\r\n\r\n                newCards.push({\r\n                    id: sectionId,\r\n                    content: htmlContent\r\n                });\r\n            }\r\n\r\n            // Loop through the rest of the parts in pairs (Title, Content)\r\n            for (let i = 1; i < parts.length; i += 2) {\r\n                const sectionTitle = parts[i].trim();\r\n                let sectionContent = parts[i + 1] ? parts[i + 1].trim() : '';\r\n\r\n                if (!sectionContent && !sectionTitle) continue;\r\n\r\n                const sectionId = `section-${i}-${Date.now()}`;\r\n\r\n                // Construct the card HTML\r\n                let htmlContent = `<h2 class=\"text-2xl font-semibold mb-4 text-gray-800\">${sectionTitle}</h2>` + sectionContent;\r\n                // htmlContent += `<div class=\"flex justify-end\"><a href=\"#\" class=\"edit-link\" data-card-id=\"${sectionId}\">EDIT</a></div>`;\r\n\r\n                newCards.push({\r\n                    id: sectionId,\r\n                    content: htmlContent\r\n                });\r\n            }\r\n\r\n            setCards(newCards);\r\n\r\n            // Save to ArticleManager\r\n            ArticleManager.saveArticle(activeId, {\r\n                title: title,\r\n                cards: newCards\r\n            });\r\n\r\n            setView('editor');\r\n            showNotificationMessage('Article generated successfully!', 'success');\r\n\r\n        } catch (error) {\r\n            console.error('Generation Error:', error);\r\n            showNotificationMessage(`Generation failed: ${error.message}`, 'error');\r\n        } finally {\r\n            setIsGenerating(false);\r\n        }\r\n    };\r\n\r\n    // Generate dynamic filters based on article topic\r\n    const generateFilters = () => {\r\n        return ARTICLE_FILTERS;\r\n    };\r\n\r\n    // Handle incoming article data from navigation (e.g., from CategoryArticlesPage)\r\n    useEffect(() => {\r\n        console.log('ðŸ” ArticleEditorApp - location.state:', location.state);\r\n        if (location.state?.editArticle) {\r\n            const { id, title, cards: articleCards } = location.state.editArticle;\r\n            console.log('âœ… Loading article:', { id, title, cardsCount: articleCards?.length });\r\n\r\n            // Normalize cards to ensure they all have ids\r\n            const rawCards = Array.isArray(articleCards) ? articleCards : [];\r\n            const normalizedCards = rawCards.map((card, index) => ({\r\n                id: card.id || `card-${index}-${Date.now()}`,\r\n                ...card\r\n            }));\r\n\r\n            // Save to ArticleManager for persistence\r\n            ArticleManager.saveArticle(id.toString(), {\r\n                title: title,\r\n                cards: normalizedCards\r\n            });\r\n\r\n            setCurrentArticleId(id);\r\n            setArticleTitle(title || 'Untitled Article');\r\n            setCards(normalizedCards);\r\n            setView('editor');\r\n            setLoadedFromNavigation(true); // Mark as loaded from navigation\r\n\r\n            // Update URL with article ID and clear navigation state\r\n            window.history.replaceState({}, document.title, `?id=${id}`);\r\n        } else if (location.state?.generateRequest) {\r\n            const { topic, detailedPrompt } = location.state.generateRequest;\r\n            console.log('âœ¨ Handling generation request from navigation:', { topic });\r\n\r\n            // Clear the state so it doesn't re-trigger on reload\r\n            window.history.replaceState({}, document.title, window.location.pathname);\r\n\r\n            handleGenerate(topic, detailedPrompt);\r\n        } else {\r\n            console.log('âš ï¸ No editArticle or generateRequest in location.state');\r\n        }\r\n    }, [location.state]);\r\n\r\n    // Handle filter changes\r\n    const handleFilterChange = (filterId, value, isMulti = false) => {\r\n        setSelectedFilters(prev => {\r\n            if (isMulti) {\r\n                const currentValues = prev[filterId] || [];\r\n                const newValues = currentValues.includes(value)\r\n                    ? currentValues.filter(v => v !== value)\r\n                    : [...currentValues, value];\r\n                return { ...prev, [filterId]: newValues };\r\n            }\r\n            return { ...prev, [filterId]: value };\r\n        });\r\n    };\r\n\r\n    // Clean all filters\r\n    const handleCleanFilters = () => {\r\n        setSelectedFilters({});\r\n    };\r\n\r\n    // Regenerate with filters\r\n    const handleRegenerateWithFilters = () => {\r\n        setShowFilterModal(false);\r\n\r\n        // Build detailed prompt from filters\r\n        let detailedPrompt = buildDetailedPrompt(selectedFilters);\r\n\r\n        const fullPrompt = refinementPrompt.trim()\r\n            ? `How to ${refinementPrompt} `\r\n            : articleTitle;\r\n\r\n        handleGenerate(fullPrompt, detailedPrompt, currentArticleId);\r\n        setRefinementPrompt('');\r\n    };\r\n\r\n    // Load filters when modal opens\r\n    useEffect(() => {\r\n        if (showFilterModal && filters.length === 0) {\r\n            setFilters(generateFilters());\r\n        }\r\n    }, [showFilterModal]);\r\n\r\n    // Fetch article from backend if not in localStorage\r\n    const fetchArticleFromBackend = async (articleId) => {\r\n        try {\r\n            const response = await fetch(`http://localhost:3003/api/articles/${articleId}`, {\r\n                credentials: 'include'\r\n            });\r\n\r\n            if (!response.ok) {\r\n                throw new Error('Article not found');\r\n            }\r\n\r\n            const { article } = await response.json();\r\n\r\n            // Parse content if it's a string\r\n            let parsedCards = [];\r\n            try {\r\n                parsedCards = typeof article.content === 'string' ? JSON.parse(article.content) : article.content;\r\n            } catch (e) {\r\n                console.error('Failed to parse article content', e);\r\n                parsedCards = [];\r\n            }\r\n\r\n            // Save to ArticleManager for future access\r\n            ArticleManager.saveArticle(articleId.toString(), {\r\n                title: article.title,\r\n                cards: parsedCards\r\n            });\r\n\r\n            setCurrentArticleId(articleId);\r\n            setArticleTitle(article.title || 'Untitled Article');\r\n            setCards(parsedCards || []);\r\n            setView('editor');\r\n        } catch (error) {\r\n            console.error('Error fetching article from backend:', error);\r\n            showNotificationMessage('Article not found. Redirecting to generator.', 'error');\r\n            window.history.replaceState(null, '', '/create');\r\n            setView('generator');\r\n        }\r\n    };\r\n\r\n    // Initialization & Routing\r\n    useEffect(() => {\r\n        // Skip if article is already loaded from navigation state\r\n        if (loadedFromNavigation) {\r\n            console.log('â© Skipping initialization - article already loaded from navigation state');\r\n            return;\r\n        }\r\n\r\n        console.log('ðŸ” Initialization useEffect - checking URL params');\r\n        const params = new URLSearchParams(window.location.search);\r\n        const urlId = params.get('id');\r\n        const urlTopic = params.get('topic');\r\n        const urlTemplate = params.get('template');\r\n\r\n        if (urlId) {\r\n            // Case 1: Load existing article by ID\r\n            console.log('ðŸ“‚ Loading article by ID:', urlId);\r\n            const article = ArticleManager.getArticle(urlId);\r\n            console.log('ðŸ“¦ Article from ArticleManager:', article);\r\n            if (article) {\r\n                console.log('âœ… Setting cards from ArticleManager:', article.cards?.length || 0, 'cards');\r\n                setCurrentArticleId(urlId);\r\n                setArticleTitle(article.title);\r\n                setCards(article.cards || []);\r\n                setView('editor');\r\n            } else {\r\n                // Article not in localStorage, try to fetch from backend\r\n                console.log('ðŸ” Article not in localStorage, fetching from backend...');\r\n                fetchArticleFromBackend(urlId);\r\n            }\r\n        } else if (urlTopic) {\r\n            // Case 2: AI Link Trigger (New Article from Topic)\r\n            // Create the article immediately\r\n            const newId = ArticleManager.createArticle(urlTopic, urlTemplate || 'guide');\r\n            setCurrentArticleId(newId);\r\n            setArticleTitle(urlTopic);\r\n\r\n            // Update URL so we don't regenerate on reload\r\n            window.history.replaceState(null, '', `?id=${newId}`);\r\n\r\n            // Trigger generation\r\n            handleGenerate(urlTopic, null, newId);\r\n        } else {\r\n            // Case 3: No ID, No Topic. Check for legacy data migration or show generator.\r\n            const migratedId = ArticleManager.migrateOldData();\r\n            if (migratedId) {\r\n                const article = ArticleManager.getArticle(migratedId);\r\n                setCurrentArticleId(migratedId);\r\n                setArticleTitle(article.title);\r\n                setCards(article.cards || []);\r\n                setView('editor');\r\n                window.history.replaceState(null, '', `?id=${migratedId}`);\r\n                showNotificationMessage('Restored your previous session.', 'info');\r\n            } else {\r\n                console.log('ðŸŽ¸ No article to load - showing generator');\r\n                setView('generator');\r\n            }\r\n        }\r\n    }, [loadedFromNavigation]);\r\n\r\n    // Handle edit link clicks\r\n    const handleEditCard = (card) => {\r\n        const event = new CustomEvent('openEditModal', { detail: card });\r\n        window.dispatchEvent(event);\r\n    };\r\n\r\n    const saveAllData = async () => {\r\n        // Wait for auth state to load\r\n        if (loading) {\r\n            showNotificationMessage('Please wait...', 'info');\r\n            return;\r\n        }\r\n\r\n        // Check if user is authenticated\r\n        if (!user) {\r\n            setShowRegistrationModal(true);\r\n            return;\r\n        }\r\n\r\n        // Save to backend\r\n        try {\r\n            console.log('ðŸ’¾ Starting save process...');\r\n            console.log('ðŸ’¾ Current article ID:', currentArticleId);\r\n            console.log('ðŸ’¾ Title:', articleTitle);\r\n            console.log('ðŸ’¾ Cards count:', cards?.length);\r\n\r\n            // Always create a new draft for category articles (they're copies)\r\n            // For user's own articles, we could add update logic later\r\n            const createResponse = await fetch('http://localhost:3003/api/articles', {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json'\r\n                },\r\n                credentials: 'include',\r\n                body: JSON.stringify({\r\n                    title: articleTitle,\r\n                    content: cards\r\n                })\r\n            });\r\n\r\n            if (!createResponse.ok) {\r\n                throw new Error('Failed to create article on backend');\r\n            }\r\n\r\n            const { article } = await createResponse.json();\r\n            const backendArticleId = article.id;\r\n            console.log('âœ… Article created with ID:', backendArticleId);\r\n\r\n            // Attach it to the authenticated user\r\n            const attachResponse = await fetch(`http://localhost:3003/api/articles/${backendArticleId}/attach`, {\r\n                method: 'PUT',\r\n                headers: {\r\n                    'Content-Type': 'application/json'\r\n                },\r\n                credentials: 'include'\r\n            });\r\n\r\n            if (!attachResponse.ok) {\r\n                throw new Error('Failed to attach article to user');\r\n            }\r\n            console.log('âœ… Article attached to user');\r\n\r\n            // Update local state with the new backend ID\r\n            setCurrentArticleId(backendArticleId);\r\n            console.log('âœ… Updated currentArticleId to:', backendArticleId);\r\n\r\n            // Save to ArticleManager with the backend ID\r\n            ArticleManager.saveArticle(backendArticleId.toString(), {\r\n                title: articleTitle,\r\n                cards: cards\r\n            });\r\n\r\n            // Update URL to reflect the new backend ID\r\n            window.history.replaceState(null, '', `?id=${backendArticleId}`);\r\n            console.log('âœ… URL updated to:', `?id=${backendArticleId}`);\r\n\r\n            showNotificationMessage('Article saved to your profile!', 'success');\r\n            console.log('âœ… Save complete!');\r\n        } catch (error) {\r\n            console.error('âŒ Save error:', error);\r\n            showNotificationMessage('Failed to save article', 'error');\r\n        }\r\n    };\r\n\r\n    const reloadPage = () => {\r\n        if (loadedFromNavigation) {\r\n            navigate(-1);\r\n            return;\r\n        }\r\n\r\n        if (window.confirm('Are you sure you want to start over? You will return to the generator.')) {\r\n            window.location.href = '/create';\r\n        }\r\n    };\r\n\r\n    const addNewCard = () => {\r\n        const newCard = {\r\n            id: 'card-' + Date.now(),\r\n            content: '',\r\n            isNew: true // Explicitly mark as new\r\n        };\r\n        const event = new CustomEvent('openEditModal', { detail: newCard });\r\n        window.dispatchEvent(event);\r\n    };\r\n\r\n    // Callback function to open the edit modal\r\n    const handleOpenEditModal = (card) => {\r\n        if (cardEditorRef.current && cardEditorRef.current.openEditModal) {\r\n            cardEditorRef.current.openEditModal(card);\r\n        }\r\n    };\r\n\r\n    // Title Editing Handlers\r\n    const handleTitleClick = () => {\r\n        setIsEditingTitle(true);\r\n        setTimeout(() => {\r\n            if (titleInputRef.current) {\r\n                titleInputRef.current.focus();\r\n            }\r\n        }, 100);\r\n    };\r\n\r\n    const handleTitleChange = (e) => {\r\n        setArticleTitle(e.target.value);\r\n    };\r\n\r\n    const handleTitleBlur = () => {\r\n        setIsEditingTitle(false);\r\n        saveAllData(); // Auto-save on blur\r\n    };\r\n\r\n    const handleTitleKeyDown = (e) => {\r\n        if (e.key === 'Enter') {\r\n            e.preventDefault();\r\n            titleInputRef.current.blur(); // This will trigger handleTitleBlur and save\r\n        }\r\n    };\r\n\r\n    const handleMoveUp = (index) => {\r\n        if (index === 0) return;\r\n        const newCards = [...cards];\r\n        const [item] = newCards.splice(index, 1);\r\n        newCards.splice(index - 1, 0, item);\r\n        setCards(newCards);\r\n        // We should probably save here too, but dragging expects manual save usually. \r\n        // For buttons, user might expect auto-update or manual save. \r\n        // Let's rely on the explicit Save button for now to avoid too many writes, \r\n        // or we could add a debounced save.\r\n    };\r\n\r\n    const handleMoveDown = (index) => {\r\n        if (index === cards.length - 1) return;\r\n        const newCards = [...cards];\r\n        const [item] = newCards.splice(index, 1);\r\n        newCards.splice(index + 1, 0, item);\r\n        setCards(newCards);\r\n    };\r\n\r\n    const handleDeleteCard = (cardId) => {\r\n        // Temporary removal of confirm for debugging\r\n        // if (window.confirm('Are you sure you want to delete this card?')) {\r\n        console.log(`[DELETE] Request for ID: \"${cardId}\" (Type: ${typeof cardId})`);\r\n\r\n        setCards(prevCards => {\r\n            console.log(`[DELETE] Current card count: ${prevCards.length}`);\r\n\r\n            // Check if ID exists before filtering\r\n            const exists = prevCards.some(c => c.id === cardId);\r\n            if (!exists) {\r\n                console.warn(`[DELETE] Warning: Card ID \"${cardId}\" not found in current state!`);\r\n                console.log('[DELETE] Available IDs:', prevCards.map(c => c.id));\r\n            }\r\n\r\n            const newCards = prevCards.filter(card => {\r\n                const isMatch = card.id === cardId;\r\n                if (isMatch) {\r\n                    console.log(`[DELETE] Matching card found and removed: \"${card.id}\"`);\r\n                }\r\n                return !isMatch;\r\n            });\r\n\r\n            console.log(`[DELETE] New card count: ${newCards.length}`);\r\n            return newCards;\r\n        });\r\n        // }\r\n    };\r\n\r\n    const handleDragEnd = (result) => {\r\n        if (!result.destination) return;\r\n\r\n        const items = Array.from(cards);\r\n        const [reorderedItem] = items.splice(result.source.index, 1);\r\n        items.splice(result.destination.index, 0, reorderedItem);\r\n\r\n        setCards(items);\r\n    };\r\n\r\n    const handleNavigate = (newView) => {\r\n        setView(newView);\r\n        if (newView === 'generator') {\r\n            window.history.pushState(null, '', '/create');\r\n        } else if (newView === 'profile') {\r\n            window.history.pushState(null, '', '/profile');\r\n        }\r\n    };\r\n\r\n    const handleEditArticle = (article) => {\r\n        setCurrentArticleId(article.id);\r\n        setArticleTitle(article.title);\r\n\r\n        let parsedCards = [];\r\n        try {\r\n            parsedCards = typeof article.content === 'string' ? JSON.parse(article.content) : article.content;\r\n        } catch (e) {\r\n            console.error(\"Failed to parse article content\", e);\r\n            parsedCards = [];\r\n        }\r\n\r\n        setCards(parsedCards || []);\r\n        setView('editor');\r\n        window.history.pushState(null, '', `?id=${article.id}`);\r\n    };\r\n\r\n    // Preload the editor when the app loads\r\n    useEffect(() => {\r\n        const timer = setTimeout(() => {\r\n            setIsEditorLoaded(true);\r\n        }, 100);\r\n        return () => clearTimeout(timer);\r\n    }, []);\r\n\r\n    const renderContent = () => {\r\n        if (view === 'loading') {\r\n            return (\r\n                <ThreeColumnLayout>\r\n                    <div className=\"flex justify-center items-center min-h-[50vh]\">\r\n                        Loading...\r\n                    </div>\r\n                </ThreeColumnLayout>\r\n            );\r\n        }\r\n\r\n        if (view === 'generator') {\r\n            return (\r\n                <ThreeColumnLayout\r\n                    left={<LeftNavigation />}\r\n                    right={<RightSidebar />}\r\n                >\r\n                    <ArticleGenerator onGenerate={handleGenerate} isGenerating={isGenerating} showInfo={false} />\r\n                </ThreeColumnLayout>\r\n            );\r\n        }\r\n\r\n        // Editor View\r\n        return (\r\n            <ThreeColumnLayout\r\n                left={<LeftNavigation />}\r\n                right={<RightSidebar />}\r\n            >\r\n                <div className=\"bg-white p-6 sm:p-8 rounded-lg shadow-lg\">\r\n                    <div className=\"flex justify-end mb-2\">\r\n                        <button\r\n                            onClick={reloadPage}\r\n                            className=\"text-gray-400 hover:text-gray-600 focus:outline-none\"\r\n                            title=\"Start Over\"\r\n                        >\r\n                            <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\r\n                            </svg>\r\n                        </button>\r\n                    </div>\r\n\r\n                    {isEditingTitle ? (\r\n                        <input\r\n                            ref={titleInputRef}\r\n                            type=\"text\"\r\n                            className=\"text-4xl font-bold mb-8 text-gray-900 w-full border-b-2 border-blue-500 focus:outline-none\"\r\n                            value={articleTitle}\r\n                            onChange={handleTitleChange}\r\n                            onBlur={handleTitleBlur}\r\n                            onKeyDown={handleTitleKeyDown}\r\n                        />\r\n                    ) : (\r\n                        <h1\r\n                            className=\"text-4xl font-bold mb-8 text-gray-900 cursor-pointer hover:bg-gray-50 rounded px-2 -ml-2 transition-colors duration-200\"\r\n                            onClick={handleTitleClick}\r\n                            title=\"Click to edit title\"\r\n                        >\r\n                            {articleTitle}\r\n                        </h1>\r\n                    )}\r\n\r\n                    <DragDropContext onDragEnd={handleDragEnd}>\r\n                        <Droppable droppableId=\"article-cards\">\r\n                            {(provided) => (\r\n                                <div {...provided.droppableProps} ref={provided.innerRef}>\r\n                                    {cards.map((card, index) => (\r\n                                        <Draggable key={card.id} draggableId={card.id} index={index}>\r\n                                            {(provided, snapshot) => (\r\n                                                <div\r\n                                                    ref={provided.innerRef}\r\n                                                    {...provided.draggableProps}\r\n                                                    className={`flex flex-row items-stretch gap-2 mb-4 group transition-colors ${snapshot.isDragging ? 'opacity-70' : ''}`}\r\n                                                >\r\n\r\n\r\n                                                    {/* Card Content */}\r\n                                                    <div className=\"flex-1 min-w-0\">\r\n                                                        <Card\r\n                                                            card={card}\r\n                                                            onEdit={handleEditCard}\r\n                                                            onMoveUp={() => handleMoveUp(index)}\r\n                                                            onMoveDown={() => handleMoveDown(index)}\r\n                                                            onDelete={() => handleDeleteCard(card.id)}\r\n                                                            isFirst={index === 0}\r\n                                                            isLast={index === cards.length - 1}\r\n                                                        />\r\n                                                    </div>\r\n                                                </div>\r\n                                            )}\r\n                                        </Draggable>\r\n                                    ))}\r\n                                    {provided.placeholder}\r\n                                </div>\r\n                            )}\r\n                        </Droppable>\r\n                    </DragDropContext>\r\n\r\n                    <ActionButtons\r\n                        onSave={saveAllData}\r\n                        onAddCard={addNewCard}\r\n                    />\r\n                </div>\r\n\r\n                {/* Refinement Bar - Moved into flow for sticky positioning */}\r\n                <RefinementBar\r\n                    value={refinementPrompt}\r\n                    onChange={setRefinementPrompt}\r\n                    onFilterClick={() => setShowFilterModal(true)}\r\n                    onSend={() => {\r\n                        if (refinementPrompt.trim() || Object.keys(selectedFilters).length > 0) {\r\n                            handleRegenerateWithFilters();\r\n                        }\r\n                    }}\r\n                    isGenerating={isGenerating}\r\n                    hasFilters={Object.keys(selectedFilters).length > 0}\r\n                />\r\n            </ThreeColumnLayout>\r\n        );\r\n    };\r\n\r\n    const handleLoginClick = () => {\r\n        setShowRegistrationModal(true);\r\n    };\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-white flex flex-col\">\r\n            <Header\r\n                articleId={currentArticleId}\r\n                articleTitle={articleTitle}\r\n                isEditingTitle={isEditingTitle}\r\n                setIsEditingTitle={setIsEditingTitle}\r\n                titleInputRef={titleInputRef}\r\n                user={user}\r\n                loading={loading}\r\n                logout={logout}\r\n                view={view}\r\n                setView={setView}\r\n                showNotificationMessage={showNotificationMessage}\r\n            />\r\n\r\n            {renderContent()}\r\n\r\n            <Footer />\r\n\r\n\r\n\r\n            {/* Filter Modal */}\r\n            <FilterModal\r\n                isOpen={showFilterModal}\r\n                onClose={() => setShowFilterModal(false)}\r\n                filters={filters}\r\n                selectedFilters={selectedFilters}\r\n                onFilterChange={handleFilterChange}\r\n                onClean={handleCleanFilters}\r\n                onRegenerate={handleRegenerateWithFilters}\r\n                isLoading={false}\r\n            />\r\n\r\n            {/* Notification */}\r\n            {\r\n                showNotification.show && (\r\n                    <div className={`notification notification-${showNotification.type}`}>\r\n                        {showNotification.message}\r\n                    </div>\r\n                )\r\n            }\r\n\r\n            {/* Edit Modal - Lazy loaded */}\r\n            {\r\n                isEditorLoaded && (\r\n                    <Suspense fallback={<div>Loading editor...</div>}>\r\n                        <CardEditor\r\n                            ref={cardEditorRef}\r\n                            cards={cards}\r\n                            setCards={setCards}\r\n                            showNotification={showNotificationMessage}\r\n                        />\r\n                    </Suspense>\r\n                )\r\n            }\r\n\r\n            {/* Registration Modal */}\r\n            <RegistrationModal\r\n                isOpen={showRegistrationModal}\r\n                onClose={() => setShowRegistrationModal(false)}\r\n                onSuccess={async () => {\r\n                    setShowRegistrationModal(false);\r\n                    // If we are in editor, save the article after successful authentication\r\n                    if (view === 'editor') {\r\n                        await saveAllData();\r\n                    }\r\n                }}\r\n            />\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default ArticleEditorApp;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}