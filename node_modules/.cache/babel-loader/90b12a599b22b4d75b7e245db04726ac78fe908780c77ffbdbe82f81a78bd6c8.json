{"ast":null,"code":"import _objectSpread from\"D:/SRC/XAMPP/htdocs/sites/UI/article-page-v08/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useRef,useImperativeHandle,memo}from'react';import ReactQuill from'react-quill';import'react-quill/dist/quill.snow.css';import{convertToHtml}from'../utils/markdown';// Import the markdown utility\n// Function to remove citations like [1], [2], [123] from text\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export function removeCitations(text){return text.replace(/\\[\\d+\\]/g,'');}const CardEditor=/*#__PURE__*/React.forwardRef((_ref,ref)=>{let{cards,setCards,showNotification}=_ref;const[isEditingMode,setIsEditingMode]=useState(false);const[currentCard,setCurrentCard]=useState(null);const[hasUnsavedChanges,setHasUnsavedChanges]=useState(false);const[isNewCard,setIsNewCard]=useState(false);const[lastAIRequest,setLastAIRequest]=useState(0);const[aiRequestCooldown]=useState(10000);// 10 seconds\nconst[title,setTitle]=useState('');const[content,setContent]=useState('');const[aiPrompt,setAiPrompt]=useState('');const[promptCounter,setPromptCounter]=useState(0);const[aiStatus,setAiStatus]=useState('• AI Ready');const titleInputRef=useRef(null);const modalRef=useRef(null);const quillRef=useRef(null);// Quill modules configuration to match original styling\nconst modules={toolbar:[[{'header':[3,4,5,6,false]}],['bold','italic','underline','strike'],[{'list':'ordered'},{'list':'bullet'}],['link'],['clean']]};const formats=['header','bold','italic','underline','strike','list','bullet','link'];// Expose methods to parent component\nuseImperativeHandle(ref,()=>({openEditModal:card=>{openEditModal(card);}}),[]);// Setup keyboard shortcuts\nuseEffect(()=>{const handleKeyDown=e=>{if(isEditingMode){if(e.key==='Escape'){e.preventDefault();closeModal();}else if(e.ctrlKey&&e.key==='Enter'){e.preventDefault();saveCardChanges();}}};document.addEventListener('keydown',handleKeyDown);return()=>{document.removeEventListener('keydown',handleKeyDown);};},[isEditingMode]);// Handle custom event for opening modal\nuseEffect(()=>{const handleOpenEditModal=e=>{openEditModal(e.detail);};window.addEventListener('openEditModal',handleOpenEditModal);return()=>{window.removeEventListener('openEditModal',handleOpenEditModal);};},[]);// Focus title input when modal opens\nuseEffect(()=>{if(isEditingMode&&titleInputRef.current){setTimeout(()=>{titleInputRef.current.focus();},100);}},[isEditingMode]);const openEditModal=card=>{setCurrentCard(card);setIsEditingMode(true);setHasUnsavedChanges(false);// Check if this is a new card (empty content)\nsetIsNewCard(!card.content||card.content.trim()==='');// Extract title and content from card HTML\nif(card.content&&card.content.trim()!==''){const parser=new DOMParser();const doc=parser.parseFromString(card.content,'text/html');const titleElement=doc.querySelector('h1, h2, h3, h4, h5, h6');const titleText=titleElement?titleElement.textContent:'';// Remove title element to get content\nif(titleElement){titleElement.remove();}// Get remaining content\nconst contentElements=Array.from(doc.body.children);let contentHTML='';contentElements.forEach(element=>{if(element.classList&&!element.classList.contains('flex')){contentHTML+=element.outerHTML;}});setTitle(titleText);setContent(contentHTML);}else{// For new cards, initialize with empty values\nsetTitle('');setContent('');}};const closeModal=()=>{if(hasUnsavedChanges){if(!window.confirm('You have unsaved changes. Are you sure you want to close without saving?')){return;}}setIsEditingMode(false);setCurrentCard(null);setIsNewCard(false);setHasUnsavedChanges(false);setTitle('');setContent('');setAiPrompt('');setPromptCounter(0);setAiStatus('• AI Ready');};const saveCardChanges=()=>{// Validate that at least title or content is provided\nif(!title.trim()&&!content.trim()){showNotification('Please enter a title or content for the card.','warning');return;}// Create new card HTML\nlet newHTML='';if(title.trim()){newHTML+=\"<h2 class=\\\"text-2xl font-semibold mb-4 text-gray-800\\\">\".concat(escapeHtml(title.trim()),\"</h2>\");}if(content.trim()){// Use the HTML content directly from Quill\nnewHTML+=content;}// Add edit link exactly as in the original\nnewHTML+=\"\\n      <div class=\\\"flex justify-end\\\">\\n        <a href=\\\"#\\\" class=\\\"edit-link\\\" data-card-id=\\\"\".concat(currentCard?currentCard.id:'new-card',\"\\\">EDIT</a>\\n      </div>\\n    \");if(isNewCard){// Create a new card\nconst newCard={id:'card-'+Date.now(),content:newHTML};setCards([...cards,newCard]);}else{// Update existing card\nconst updatedCards=cards.map(card=>{if(card.id===currentCard.id){return _objectSpread(_objectSpread({},card),{},{content:newHTML});}return card;});setCards(updatedCards);}// Show success feedback\nconst message=isNewCard?'New card added successfully!':'Card updated successfully!';showNotification(message,'success');// Close modal\ncloseModal();};const escapeHtml=text=>{const div=document.createElement('div');div.textContent=text;return div.innerHTML;};const handleAiPromptChange=e=>{const value=e.target.value;setAiPrompt(value);setPromptCounter(value.length);// Color coding based on length (matching original behavior)\nif(value.length<10){const counterElement=document.getElementById('promptCounter');if(counterElement){counterElement.className='text-gray-400';}}else if(value.length<=500){const counterElement=document.getElementById('promptCounter');if(counterElement){counterElement.className='text-green-600';}}else{// Trim to maximum length\nconst trimmedValue=value.substring(0,500);setAiPrompt(trimmedValue);setPromptCounter(500);const counterElement=document.getElementById('promptCounter');if(counterElement){counterElement.className='text-red-600';}}};const validatePrompt=prompt=>{// Length validation\nif(prompt.length<10){return{isValid:false,error:'Prompt too short. Minimum 10 characters required.'};}if(prompt.length>500){return{isValid:false,error:'Prompt too long. Maximum 500 characters allowed.'};}// Forbidden phrases\nconst forbiddenPhrases=['измени тему','добавь рекламу','смени направление','change topic','add advertisement','change direction'];const lowerPrompt=prompt.toLowerCase();for(const phrase of forbiddenPhrases){if(lowerPrompt.includes(phrase.toLowerCase())){return{isValid:false,error:\"Forbidden phrase detected: \\\"\".concat(phrase,\"\\\". Please reformulate your request for clarity/structure improvement.\")};}}return{isValid:true};};const sendAIPrompt=async()=>{const validation=validatePrompt(aiPrompt);if(!validation.isValid){showNotification(\"Validation Error: \".concat(validation.error),'error');return;}// Check rate limiting\nconst now=Date.now();if(now-lastAIRequest<aiRequestCooldown){const remainingTime=Math.ceil((aiRequestCooldown-(now-lastAIRequest))/1000);showNotification(\"Please wait \".concat(remainingTime,\" seconds before next AI request.\"),'warning');return;}// Show loading state\nsetAiStatus('• Processing...');const statusElement=document.getElementById('aiStatus');if(statusElement){statusElement.className='ml-2 text-blue-600 text-xs';}try{// Get current card content for context\nconst systemPrompt=\"You are an article editor for project management content for digital projects.\\n\\nYOU CAN:\\n- Improve clarity of formulations\\n- Add structure (lists, headings)\\n- Add checklists and stages\\n- Add <ai-link> tags for complex sub-topics\\n\\nYOU CANNOT:\\n- Add unconfirmed facts\\n- Advertise tools without marking\\n- Contradict original meaning\\n\\nAI LINKS INSTRUCTION:\\nIf you mention a complex sub-topic that deserves its own separate guide, wrap it in an <ai-link> tag.\\nFormat: <ai-link topic=\\\"Exact Topic Title\\\" template=\\\"guide\\\">visible text</ai-link>\\n\\nIf prompt violates rules, respond: \\\"ERROR: [reason]. Please reformulate your request for clarity/structure improvement.\\\"\\n\\nCurrent title: \\\"\".concat(title,\"\\\"\\nCurrent content: \\\"\").concat(content.replace(/<[^>]*>/g,''),\"\\\"\\n\\nUser requests: \").concat(aiPrompt,\"\\n\\nReturn improved content in JSON format:\\n{\\n  \\\"title\\\": \\\"improved title\\\",\\n  \\\"content\\\": \\\"improved content\\\"\\n}\");const response=await fetch('https://api.perplexity.ai/chat/completions',{method:'POST',headers:{'Content-Type':'application/json','Authorization':'Bearer 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'},body:JSON.stringify({model:'sonar-pro',messages:[{role:'user',content:systemPrompt}],temperature:0.7,max_tokens:1000})});if(!response.ok){throw new Error(\"API request failed: \".concat(response.status));}const data=await response.json();const aiResponse=data.choices[0].message.content;// Check if response is an error\nif(aiResponse.startsWith('ERROR:')){showNotification(aiResponse,'error');return;}// Try to parse JSON response\nlet parsedResponse;try{// Extract JSON from response if it's wrapped in quotes or other text\nconst jsonMatch=aiResponse.match(/\\{[\\s\\S]*\\}/);if(jsonMatch){parsedResponse=JSON.parse(jsonMatch[0]);}else{throw new Error('No JSON found in response');}}catch(e){// If not JSON, treat as plain text improvement\nparsedResponse={title:title,content:aiResponse};}// Remove citations from the AI response content\nif(parsedResponse.content){parsedResponse.content=removeCitations(parsedResponse.content);}// Update the form fields with AI suggestions\nif(parsedResponse.title){setTitle(parsedResponse.title);}if(parsedResponse.content){// Convert AI-generated content from markdown/plain text to HTML\nconst htmlContent=convertToHtml(parsedResponse.content);setContent(htmlContent);}// Mark as having unsaved changes\nsetHasUnsavedChanges(true);showNotification('AI improvements applied! Review and save changes.','success');setLastAIRequest(now);}catch(error){console.error('AI API Error:',error);showNotification('AI service temporarily unavailable. Please try again later.','error');}finally{setAiStatus('• AI Ready');const statusElement=document.getElementById('aiStatus');if(statusElement){statusElement.className='ml-2 text-green-600 text-xs';}setAiPrompt('');setPromptCounter(0);}};const handleTitleChange=e=>{setTitle(e.target.value);setHasUnsavedChanges(true);};const handleContentChange=value=>{setContent(value);setHasUnsavedChanges(true);};// Handle Enter key in AI prompt (matching original behavior)\nconst handleAiPromptKeyDown=e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendAIPrompt();}};// Memoize the Quill component to prevent unnecessary re-renders\nconst quillModules=React.useMemo(()=>modules,[]);const quillFormats=React.useMemo(()=>formats,[]);return/*#__PURE__*/_jsx(\"div\",{id:\"editModal\",className:\"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center p-0 hidden z-50\",style:{display:isEditingMode?'flex':'none'},ref:modalRef,children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-none w-full h-full shadow-xl transition-all duration-300 flex flex-col\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 border-b border-gray-200\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-end mb-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4\",children:[/*#__PURE__*/_jsx(\"button\",{id:\"saveCardEdit\",className:\"text-blue-500 font-semibold text-sm hover:underline focus:outline-none\",onClick:saveCardChanges,children:\"SAVE\"}),/*#__PURE__*/_jsx(\"button\",{id:\"closeModal\",className:\"text-gray-400 hover:text-gray-600 focus:outline-none\",onClick:closeModal,children:/*#__PURE__*/_jsx(\"svg\",{className:\"w-6 h-6\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",xmlns:\"http://www.w3.org/2000/svg\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:\"2\",d:\"M6 18L18 6M6 6l12 12\"})})})]})}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",id:\"cardTitle\",className:\"text-xl font-bold text-gray-800 border-none outline-none bg-transparent w-full\",placeholder:\"Enter section title\",value:title,onChange:handleTitleChange,ref:titleInputRef})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 flex flex-col overflow-hidden\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-1 overflow-y-auto p-4\",children:/*#__PURE__*/_jsx(ReactQuill,{ref:quillRef,theme:\"snow\",value:content,onChange:handleContentChange,modules:quillModules,formats:quillFormats,className:\"h-full\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"border-t border-gray-200 p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col items-end\",children:[/*#__PURE__*/_jsx(\"textarea\",{id:\"aiPrompt\",className:\"w-full p-3 rounded-lg outline-none text-gray-600 resize-none transition-colors focus:border-blue-300\",placeholder:\"Write prompt for AI assistance...\",rows:\"2\",value:aiPrompt,onChange:handleAiPromptChange,onKeyDown:handleAiPromptKeyDown}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2 flex items-center justify-between w-full\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-gray-400\",children:[/*#__PURE__*/_jsx(\"span\",{id:\"promptCounter\",children:promptCounter}),\"/500 characters\",/*#__PURE__*/_jsx(\"span\",{id:\"aiStatus\",className:\"ml-2 text-green-600 text-xs\",children:aiStatus})]}),/*#__PURE__*/_jsx(\"button\",{id:\"sendPrompt\",className:\"p-2 rounded-full bg-blue-500 text-white shadow-md hover:bg-blue-600 transition-all duration-300 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed\",onClick:sendAIPrompt,disabled:aiStatus==='• Processing...',children:/*#__PURE__*/_jsx(\"svg\",{className:\"w-5 h-5\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",xmlns:\"http://www.w3.org/2000/svg\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:\"2\",d:\"M12 19l9 2-9-18-9 18 9-2zm0 0v-8\"})})})]})]})})]})]})});});// Memoize the component to prevent unnecessary re-renders\nexport default/*#__PURE__*/memo(CardEditor);","map":{"version":3,"names":["React","useState","useEffect","useRef","useImperativeHandle","memo","ReactQuill","convertToHtml","jsx","_jsx","jsxs","_jsxs","removeCitations","text","replace","CardEditor","forwardRef","_ref","ref","cards","setCards","showNotification","isEditingMode","setIsEditingMode","currentCard","setCurrentCard","hasUnsavedChanges","setHasUnsavedChanges","isNewCard","setIsNewCard","lastAIRequest","setLastAIRequest","aiRequestCooldown","title","setTitle","content","setContent","aiPrompt","setAiPrompt","promptCounter","setPromptCounter","aiStatus","setAiStatus","titleInputRef","modalRef","quillRef","modules","toolbar","formats","openEditModal","card","handleKeyDown","e","key","preventDefault","closeModal","ctrlKey","saveCardChanges","document","addEventListener","removeEventListener","handleOpenEditModal","detail","window","current","setTimeout","focus","trim","parser","DOMParser","doc","parseFromString","titleElement","querySelector","titleText","textContent","remove","contentElements","Array","from","body","children","contentHTML","forEach","element","classList","contains","outerHTML","confirm","newHTML","concat","escapeHtml","id","newCard","Date","now","updatedCards","map","_objectSpread","message","div","createElement","innerHTML","handleAiPromptChange","value","target","length","counterElement","getElementById","className","trimmedValue","substring","validatePrompt","prompt","isValid","error","forbiddenPhrases","lowerPrompt","toLowerCase","phrase","includes","sendAIPrompt","validation","remainingTime","Math","ceil","statusElement","systemPrompt","response","fetch","method","headers","JSON","stringify","model","messages","role","temperature","max_tokens","ok","Error","status","data","json","aiResponse","choices","startsWith","parsedResponse","jsonMatch","match","parse","htmlContent","console","handleTitleChange","handleContentChange","handleAiPromptKeyDown","shiftKey","quillModules","useMemo","quillFormats","style","display","onClick","fill","stroke","viewBox","xmlns","strokeLinecap","strokeLinejoin","strokeWidth","d","type","placeholder","onChange","theme","rows","onKeyDown","disabled"],"sources":["D:/SRC/XAMPP/htdocs/sites/UI/article-page-v08/src/components/CardEditor.js"],"sourcesContent":["import React, { useState, useEffect, useRef, useImperativeHandle, memo } from 'react';\nimport ReactQuill from 'react-quill';\nimport 'react-quill/dist/quill.snow.css';\nimport { convertToHtml } from '../utils/markdown'; // Import the markdown utility\n\n// Function to remove citations like [1], [2], [123] from text\nexport function removeCitations(text) {\n  return text.replace(/\\[\\d+\\]/g, '');\n}\n\nconst CardEditor = React.forwardRef(({ cards, setCards, showNotification }, ref) => {\n  const [isEditingMode, setIsEditingMode] = useState(false);\n  const [currentCard, setCurrentCard] = useState(null);\n  const [hasUnsavedChanges, setHasUnsavedChanges] = useState(false);\n  const [isNewCard, setIsNewCard] = useState(false);\n  const [lastAIRequest, setLastAIRequest] = useState(0);\n  const [aiRequestCooldown] = useState(10000); // 10 seconds\n  const [title, setTitle] = useState('');\n  const [content, setContent] = useState('');\n  const [aiPrompt, setAiPrompt] = useState('');\n  const [promptCounter, setPromptCounter] = useState(0);\n  const [aiStatus, setAiStatus] = useState('• AI Ready');\n\n  const titleInputRef = useRef(null);\n  const modalRef = useRef(null);\n  const quillRef = useRef(null);\n\n  // Quill modules configuration to match original styling\n  const modules = {\n    toolbar: [\n      [{ 'header': [3, 4, 5, 6, false] }],\n      ['bold', 'italic', 'underline', 'strike'],\n      [{ 'list': 'ordered' }, { 'list': 'bullet' }],\n      ['link'],\n      ['clean']\n    ],\n  };\n\n  const formats = [\n    'header',\n    'bold', 'italic', 'underline', 'strike',\n    'list', 'bullet',\n    'link'\n  ];\n\n  // Expose methods to parent component\n  useImperativeHandle(ref, () => ({\n    openEditModal: (card) => {\n      openEditModal(card);\n    }\n  }), []);\n\n  // Setup keyboard shortcuts\n  useEffect(() => {\n    const handleKeyDown = (e) => {\n      if (isEditingMode) {\n        if (e.key === 'Escape') {\n          e.preventDefault();\n          closeModal();\n        } else if (e.ctrlKey && e.key === 'Enter') {\n          e.preventDefault();\n          saveCardChanges();\n        }\n      }\n    };\n\n    document.addEventListener('keydown', handleKeyDown);\n    return () => {\n      document.removeEventListener('keydown', handleKeyDown);\n    };\n  }, [isEditingMode]);\n\n  // Handle custom event for opening modal\n  useEffect(() => {\n    const handleOpenEditModal = (e) => {\n      openEditModal(e.detail);\n    };\n\n    window.addEventListener('openEditModal', handleOpenEditModal);\n    return () => {\n      window.removeEventListener('openEditModal', handleOpenEditModal);\n    };\n  }, []);\n\n  // Focus title input when modal opens\n  useEffect(() => {\n    if (isEditingMode && titleInputRef.current) {\n      setTimeout(() => {\n        titleInputRef.current.focus();\n      }, 100);\n    }\n  }, [isEditingMode]);\n\n  const openEditModal = (card) => {\n    setCurrentCard(card);\n    setIsEditingMode(true);\n    setHasUnsavedChanges(false);\n\n    // Check if this is a new card (empty content)\n    setIsNewCard(!card.content || card.content.trim() === '');\n\n    // Extract title and content from card HTML\n    if (card.content && card.content.trim() !== '') {\n      const parser = new DOMParser();\n      const doc = parser.parseFromString(card.content, 'text/html');\n\n      const titleElement = doc.querySelector('h1, h2, h3, h4, h5, h6');\n      const titleText = titleElement ? titleElement.textContent : '';\n\n      // Remove title element to get content\n      if (titleElement) {\n        titleElement.remove();\n      }\n\n      // Get remaining content\n      const contentElements = Array.from(doc.body.children);\n      let contentHTML = '';\n      contentElements.forEach(element => {\n        if (element.classList && !element.classList.contains('flex')) {\n          contentHTML += element.outerHTML;\n        }\n      });\n\n      setTitle(titleText);\n      setContent(contentHTML);\n    } else {\n      // For new cards, initialize with empty values\n      setTitle('');\n      setContent('');\n    }\n  };\n\n  const closeModal = () => {\n    if (hasUnsavedChanges) {\n      if (!window.confirm('You have unsaved changes. Are you sure you want to close without saving?')) {\n        return;\n      }\n    }\n\n    setIsEditingMode(false);\n    setCurrentCard(null);\n    setIsNewCard(false);\n    setHasUnsavedChanges(false);\n    setTitle('');\n    setContent('');\n    setAiPrompt('');\n    setPromptCounter(0);\n    setAiStatus('• AI Ready');\n  };\n\n  const saveCardChanges = () => {\n    // Validate that at least title or content is provided\n    if (!title.trim() && !content.trim()) {\n      showNotification('Please enter a title or content for the card.', 'warning');\n      return;\n    }\n\n    // Create new card HTML\n    let newHTML = '';\n\n    if (title.trim()) {\n      newHTML += `<h2 class=\"text-2xl font-semibold mb-4 text-gray-800\">${escapeHtml(title.trim())}</h2>`;\n    }\n\n    if (content.trim()) {\n      // Use the HTML content directly from Quill\n      newHTML += content;\n    }\n\n    // Add edit link exactly as in the original\n    newHTML += `\n      <div class=\"flex justify-end\">\n        <a href=\"#\" class=\"edit-link\" data-card-id=\"${currentCard ? currentCard.id : 'new-card'}\">EDIT</a>\n      </div>\n    `;\n\n    if (isNewCard) {\n      // Create a new card\n      const newCard = {\n        id: 'card-' + Date.now(),\n        content: newHTML\n      };\n      setCards([...cards, newCard]);\n    } else {\n      // Update existing card\n      const updatedCards = cards.map(card => {\n        if (card.id === currentCard.id) {\n          return { ...card, content: newHTML };\n        }\n        return card;\n      });\n      setCards(updatedCards);\n    }\n\n    // Show success feedback\n    const message = isNewCard ? 'New card added successfully!' : 'Card updated successfully!';\n    showNotification(message, 'success');\n\n    // Close modal\n    closeModal();\n  };\n\n  const escapeHtml = (text) => {\n    const div = document.createElement('div');\n    div.textContent = text;\n    return div.innerHTML;\n  };\n\n  const handleAiPromptChange = (e) => {\n    const value = e.target.value;\n    setAiPrompt(value);\n    setPromptCounter(value.length);\n\n    // Color coding based on length (matching original behavior)\n    if (value.length < 10) {\n      const counterElement = document.getElementById('promptCounter');\n      if (counterElement) {\n        counterElement.className = 'text-gray-400';\n      }\n    } else if (value.length <= 500) {\n      const counterElement = document.getElementById('promptCounter');\n      if (counterElement) {\n        counterElement.className = 'text-green-600';\n      }\n    } else {\n      // Trim to maximum length\n      const trimmedValue = value.substring(0, 500);\n      setAiPrompt(trimmedValue);\n      setPromptCounter(500);\n      const counterElement = document.getElementById('promptCounter');\n      if (counterElement) {\n        counterElement.className = 'text-red-600';\n      }\n    }\n  };\n\n  const validatePrompt = (prompt) => {\n    // Length validation\n    if (prompt.length < 10) {\n      return { isValid: false, error: 'Prompt too short. Minimum 10 characters required.' };\n    }\n    if (prompt.length > 500) {\n      return { isValid: false, error: 'Prompt too long. Maximum 500 characters allowed.' };\n    }\n\n    // Forbidden phrases\n    const forbiddenPhrases = [\n      'измени тему',\n      'добавь рекламу',\n      'смени направление',\n      'change topic',\n      'add advertisement',\n      'change direction'\n    ];\n\n    const lowerPrompt = prompt.toLowerCase();\n    for (const phrase of forbiddenPhrases) {\n      if (lowerPrompt.includes(phrase.toLowerCase())) {\n        return {\n          isValid: false,\n          error: `Forbidden phrase detected: \"${phrase}\". Please reformulate your request for clarity/structure improvement.`\n        };\n      }\n    }\n\n    return { isValid: true };\n  };\n\n  const sendAIPrompt = async () => {\n    const validation = validatePrompt(aiPrompt);\n    if (!validation.isValid) {\n      showNotification(`Validation Error: ${validation.error}`, 'error');\n      return;\n    }\n\n    // Check rate limiting\n    const now = Date.now();\n    if (now - lastAIRequest < aiRequestCooldown) {\n      const remainingTime = Math.ceil((aiRequestCooldown - (now - lastAIRequest)) / 1000);\n      showNotification(`Please wait ${remainingTime} seconds before next AI request.`, 'warning');\n      return;\n    }\n\n    // Show loading state\n    setAiStatus('• Processing...');\n    const statusElement = document.getElementById('aiStatus');\n    if (statusElement) {\n      statusElement.className = 'ml-2 text-blue-600 text-xs';\n    }\n\n    try {\n      // Get current card content for context\n      const systemPrompt = `You are an article editor for project management content for digital projects.\n\nYOU CAN:\n- Improve clarity of formulations\n- Add structure (lists, headings)\n- Add checklists and stages\n- Add <ai-link> tags for complex sub-topics\n\nYOU CANNOT:\n- Add unconfirmed facts\n- Advertise tools without marking\n- Contradict original meaning\n\nAI LINKS INSTRUCTION:\nIf you mention a complex sub-topic that deserves its own separate guide, wrap it in an <ai-link> tag.\nFormat: <ai-link topic=\"Exact Topic Title\" template=\"guide\">visible text</ai-link>\n\nIf prompt violates rules, respond: \"ERROR: [reason]. Please reformulate your request for clarity/structure improvement.\"\n\nCurrent title: \"${title}\"\nCurrent content: \"${content.replace(/<[^>]*>/g, '')}\"\n\nUser requests: ${aiPrompt}\n\nReturn improved content in JSON format:\n{\n  \"title\": \"improved title\",\n  \"content\": \"improved content\"\n}`;\n\n      const response = await fetch('https://api.perplexity.ai/chat/completions', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': 'Bearer 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'\n        },\n        body: JSON.stringify({\n          model: 'sonar-pro',\n          messages: [\n            { role: 'user', content: systemPrompt }\n          ],\n          temperature: 0.7,\n          max_tokens: 1000\n        })\n      });\n\n      if (!response.ok) {\n        throw new Error(`API request failed: ${response.status}`);\n      }\n\n      const data = await response.json();\n      const aiResponse = data.choices[0].message.content;\n\n      // Check if response is an error\n      if (aiResponse.startsWith('ERROR:')) {\n        showNotification(aiResponse, 'error');\n        return;\n      }\n\n      // Try to parse JSON response\n      let parsedResponse;\n      try {\n        // Extract JSON from response if it's wrapped in quotes or other text\n        const jsonMatch = aiResponse.match(/\\{[\\s\\S]*\\}/);\n        if (jsonMatch) {\n          parsedResponse = JSON.parse(jsonMatch[0]);\n        } else {\n          throw new Error('No JSON found in response');\n        }\n      } catch (e) {\n        // If not JSON, treat as plain text improvement\n        parsedResponse = {\n          title: title,\n          content: aiResponse\n        };\n      }\n\n      // Remove citations from the AI response content\n      if (parsedResponse.content) {\n        parsedResponse.content = removeCitations(parsedResponse.content);\n      }\n\n      // Update the form fields with AI suggestions\n      if (parsedResponse.title) {\n        setTitle(parsedResponse.title);\n      }\n\n      if (parsedResponse.content) {\n        // Convert AI-generated content from markdown/plain text to HTML\n        const htmlContent = convertToHtml(parsedResponse.content);\n        setContent(htmlContent);\n      }\n\n      // Mark as having unsaved changes\n      setHasUnsavedChanges(true);\n\n      showNotification('AI improvements applied! Review and save changes.', 'success');\n      setLastAIRequest(now);\n    } catch (error) {\n      console.error('AI API Error:', error);\n      showNotification('AI service temporarily unavailable. Please try again later.', 'error');\n    } finally {\n      setAiStatus('• AI Ready');\n      const statusElement = document.getElementById('aiStatus');\n      if (statusElement) {\n        statusElement.className = 'ml-2 text-green-600 text-xs';\n      }\n      setAiPrompt('');\n      setPromptCounter(0);\n    }\n  };\n\n  const handleTitleChange = (e) => {\n    setTitle(e.target.value);\n    setHasUnsavedChanges(true);\n  };\n\n  const handleContentChange = (value) => {\n    setContent(value);\n    setHasUnsavedChanges(true);\n  };\n\n  // Handle Enter key in AI prompt (matching original behavior)\n  const handleAiPromptKeyDown = (e) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      sendAIPrompt();\n    }\n  };\n\n  // Memoize the Quill component to prevent unnecessary re-renders\n  const quillModules = React.useMemo(() => modules, []);\n  const quillFormats = React.useMemo(() => formats, []);\n\n  return (\n    <div\n      id=\"editModal\"\n      className=\"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center p-0 hidden z-50\"\n      style={{ display: isEditingMode ? 'flex' : 'none' }}\n      ref={modalRef}\n    >\n      <div className=\"bg-white rounded-none w-full h-full shadow-xl transition-all duration-300 flex flex-col\">\n        <div className=\"p-4 border-b border-gray-200\">\n          {/* Buttons moved to top and right-aligned */}\n          <div className=\"flex justify-end mb-4\">\n            <div className=\"flex items-center space-x-4\">\n              <button\n                id=\"saveCardEdit\"\n                className=\"text-blue-500 font-semibold text-sm hover:underline focus:outline-none\"\n                onClick={saveCardChanges}\n              >\n                SAVE\n              </button>\n              <button\n                id=\"closeModal\"\n                className=\"text-gray-400 hover:text-gray-600 focus:outline-none\"\n                onClick={closeModal}\n              >\n                <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\n                </svg>\n              </button>\n            </div>\n          </div>\n\n          {/* Title input below buttons */}\n          <input\n            type=\"text\"\n            id=\"cardTitle\"\n            className=\"text-xl font-bold text-gray-800 border-none outline-none bg-transparent w-full\"\n            placeholder=\"Enter section title\"\n            value={title}\n            onChange={handleTitleChange}\n            ref={titleInputRef}\n          />\n        </div>\n\n        <div className=\"flex-1 flex flex-col overflow-hidden\">\n          <div className=\"flex-1 overflow-y-auto p-4\">\n            <ReactQuill\n              ref={quillRef}\n              theme=\"snow\"\n              value={content}\n              onChange={handleContentChange}\n              modules={quillModules}\n              formats={quillFormats}\n              className=\"h-full\"\n            />\n          </div>\n\n          <div className=\"border-t border-gray-200 p-4\">\n            <div className=\"flex flex-col items-end\">\n              <textarea\n                id=\"aiPrompt\"\n                className=\"w-full p-3 rounded-lg outline-none text-gray-600 resize-none transition-colors focus:border-blue-300\"\n                placeholder=\"Write prompt for AI assistance...\"\n                rows=\"2\"\n                value={aiPrompt}\n                onChange={handleAiPromptChange}\n                onKeyDown={handleAiPromptKeyDown}\n              />\n              <div className=\"mt-2 flex items-center justify-between w-full\">\n                <div className=\"text-xs text-gray-400\">\n                  <span id=\"promptCounter\">{promptCounter}</span>/500 characters\n                  <span id=\"aiStatus\" className=\"ml-2 text-green-600 text-xs\">{aiStatus}</span>\n                </div>\n                <button\n                  id=\"sendPrompt\"\n                  className=\"p-2 rounded-full bg-blue-500 text-white shadow-md hover:bg-blue-600 transition-all duration-300 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed\"\n                  onClick={sendAIPrompt}\n                  disabled={aiStatus === '• Processing...'}\n                >\n                  <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M12 19l9 2-9-18-9 18 9-2zm0 0v-8\"></path>\n                  </svg>\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n});\n\n// Memoize the component to prevent unnecessary re-renders\nexport default memo(CardEditor);"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}